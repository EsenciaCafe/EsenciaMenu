<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Esencia â€” Carta</title>
  <meta name="theme-color" content="#ffffff" />
  <meta name="description" content="Carta de Esencia: cafÃ©s, mini pancakes, desayunos, bebidas. IGIC incluido." />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Landing */
    .lang-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 2rem;
    }
    .lang-btn {
      font-size: 2rem; /* banderas grandes */
      line-height: 1;
      background: var(--chip, #f7f7f8);
      border: 1px solid var(--line, #e5e7eb);
      border-radius: var(--radius-lg, 18px);
      padding: 1rem;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .lang-btn:hover { transform: scale(1.05); }

    /* Switch en carta */
    .lang-switch {
      display: flex;
      gap: 6px;
    }
    .lang-chip {
      font-size: 1.3rem;
      line-height: 1;
      padding: 6px 10px;
      border-radius: var(--radius, 14px);
      background: var(--chip, #f7f7f8);
      border: 1px solid var(--line, #e5e7eb);
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .lang-chip.active {
      background: var(--accent, #b08968);
      color: #fff;
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
  <header class="site-header">
    <img src="logo.png" alt="Esencia" class="logo-img" />
    <!-- Switch de idioma en carta -->
    <div id="lang-switch" class="lang-switch hidden" role="group" aria-label="Language switch">
      <button id="chip-es" class="lang-chip" aria-label="EspaÃ±ol" title="EspaÃ±ol">ðŸ‡ªðŸ‡¸</button>
      <button id="chip-en" class="lang-chip" aria-label="English" title="English">ðŸ‡¬ðŸ‡§</button>
    </div>
  </header>

  <!-- Landing inicial -->
  <main id="landing">
    <h1>Bienvenido a Esencia</h1>
    <p>Selecciona tu idioma:</p>
    <div class="lang-grid">
      <button id="btn-es" class="lang-btn" aria-label="EspaÃ±ol" title="EspaÃ±ol">ðŸ‡ªðŸ‡¸</button>
      <button id="btn-en" class="lang-btn" aria-label="English" title="English">ðŸ‡¬ðŸ‡§</button>
    </div>
  </main>

  <!-- Carta -->
  <main id="menu" class="hidden">
    <nav id="nav" class="chips"></nav>
    <div id="app"></div>
    <footer><p id="igic-note">IGIC incluido</p></footer>
  </main>

  <script type="module" src="firebase.js"></script>
  <script type="module" src="app.multilang.js"></script>

  <script>
    const landing = document.getElementById("landing");
    const menu = document.getElementById("menu");
    const switchEl = document.getElementById("lang-switch");
    const btnEs = document.getElementById("btn-es");
    const btnEn = document.getElementById("btn-en");
    const chipEs = document.getElementById("chip-es");
    const chipEn = document.getElementById("chip-en");

    function showMenuWith(lang){
      window.LOCALE = lang;
      localStorage.setItem("lang", lang);
      landing.classList.add("hidden");
      menu.classList.remove("hidden");
      switchEl.classList.remove("hidden");
      if (lang === "es"){
        chipEs.classList.add("active");
        chipEn.classList.remove("active");
      } else {
        chipEn.classList.add("active");
        chipEs.classList.remove("active");
      }
      // Forzar recarga del app.js
      import(`./app.multilang.js?lang=${lang}&t=${Date.now()}`);
      window.__menuLoaded = true;
    }

    // Botones landing
    btnEs.addEventListener("click", ()=> showMenuWith("es"));
    btnEn.addEventListener("click", ()=> showMenuWith("en"));

    // Switch en carta
    chipEs.addEventListener("click", ()=> showMenuWith("es"));
    chipEn.addEventListener("click", ()=> showMenuWith("en"));

    // Idioma guardado
    const saved = localStorage.getItem("lang");

    // Query param ?lang=es|en
    const qp = new URLSearchParams(location.search);
    const langQP = qp.get("lang");
    if ((langQP === "es" || langQP === "en") && !saved) {
      showMenuWith(langQP);
    }

    // Si hay guardado y no hay query param
    if (!window.__menuLoaded && (saved === "es" || saved === "en") && !langQP) {
      showMenuWith(saved);
    }
  </script>
</body>
</html>
