<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Esencia â€” Carta</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Layout header con chips arriba a la derecha */
    .site-header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:12px 16px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo-img{max-height:64px; height:auto; width:auto}

    .lang-switch{display:flex; gap:8px; align-items:center}
    .lang-chip{
      width:32px; height:32px; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      font-size:18px; line-height:1;
      border:1px solid var(--line, #e5e7eb); background:#fff;
      box-shadow: 0 1px 2px rgba(0,0,0,.06);
      cursor:pointer; transition:transform .1s, box-shadow .2s, border-color .2s;
    }
    .lang-chip:hover{ transform: translateY(-1px); }
    .lang-chip.active{ border-color: var(--accent, #b08968); box-shadow: 0 0 0 2px rgba(176,137,104,.15); }

    @media(max-width:480px){ .lang-chip{ width:28px; height:28px; font-size:16px; } }

    /* Landing bÃ¡sica */
    .landing{max-width:980px; margin:24px auto; padding:0 16px; text-align:left;}
    .lang-grid{display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-top:16px;}
    .lang-btn{
      font-size:1.5rem; line-height:1;
      border-radius:16px; border:1px solid var(--line, #e5e7eb);
      background:#f7f7f8; padding:14px; cursor:pointer;
    }
    @media(max-width:640px){ .lang-grid{ grid-template-columns:1fr; } }

    .hidden{display:none !important;}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <img src="logo_letras.png" alt="Esencia" class="logo-img" />
      <span class="tag">ReposterÃ­a casera â€” IGIC incluido</span>
    </div>
    <!-- chips pequeÃ±os arriba a la derecha -->
    <div id="lang-switch" class="lang-switch hidden" role="group" aria-label="Language switch">
      <button id="chip-es" class="lang-chip" aria-label="EspaÃ±ol" title="EspaÃ±ol">ðŸ‡ªðŸ‡¸</button>
      <button id="chip-en" class="lang-chip" aria-label="English" title="English">ðŸ‡¬ðŸ‡§</button>
    </div>
  </header>

  <!-- LANDING -->
  <main id="landing" class="landing">
    <h1>Bienvenido a Esencia</h1>
    <p>Selecciona tu idioma:</p>
    <div class="lang-grid">
      <button id="btn-es" class="lang-btn" aria-label="EspaÃ±ol" title="EspaÃ±ol">ðŸ‡ªðŸ‡¸</button>
      <button id="btn-en" class="lang-btn" aria-label="English" title="English">ðŸ‡¬ðŸ‡§</button>
    </div>
  </main>

  <!-- CARTA -->
  <main id="menu" class="hidden">
    <nav id="nav" class="nav"></nav>
    <div id="app" class="container"></div>
    <footer class="site-footer"><small id="igic-note">IGIC incluido</small></footer>
  </main>

  <!-- Firebase lo puedes dejar cargado global -->
  <script type="module" src="firebase.js"></script>

  <script>
    // === CONTROL DE IDIOMA ===
    const landing = document.getElementById("landing");
    const menu = document.getElementById("menu");
    const switchEl = document.getElementById("lang-switch");
    const chipEs = document.getElementById("chip-es");
    const chipEn = document.getElementById("chip-en");

    function setActiveChip(lang){
      chipEs.classList.toggle("active", lang==="es");
      chipEn.classList.toggle("active", lang==="en");
    }

    async function showMenuWith(lang){
      window.LOCALE = (lang === "en") ? "en" : "es";
      localStorage.setItem("lang", window.LOCALE);
      landing.classList.add("hidden");
      menu.classList.remove("hidden");
      switchEl.classList.remove("hidden");
      setActiveChip(window.LOCALE);

      // Cargamos la carta SOLO una vez
      if (!window.__menuLoaded) {
        window.__menuLoaded = true;
        const script = document.createElement("script");
        script.type = "module";
        script.src = "./app.multilang.js";
        document.body.appendChild(script);
      } else {
        // Pedimos re-render en el nuevo idioma
        window.__setLocale?.(window.LOCALE);
      }
    }

    // Landing
    document.getElementById("btn-es").addEventListener("click", ()=> showMenuWith("es"));
    document.getElementById("btn-en").addEventListener("click", ()=> showMenuWith("en"));

    // Chips del header
    chipEs.addEventListener("click", ()=> showMenuWith("es"));
    chipEn.addEventListener("click", ()=> showMenuWith("en"));

    // Soporte ?lang=es|en
    const saved = localStorage.getItem("lang");
    const qp = new URLSearchParams(location.search);
    const langQP = qp.get("lang");

    if (langQP === "es" || langQP === "en") {
      showMenuWith(langQP);
    } else if (saved === "es" || saved === "en") {
      showMenuWith(saved);
    }
    // Si no hay nada, se queda en la landing esperando elecciÃ³n
  </script>
</body>
</html>
